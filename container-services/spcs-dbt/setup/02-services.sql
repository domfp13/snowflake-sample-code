USE ROLE SYSADMIN;
USE WAREHOUSE COMPUTE_WH;
USE DATABASE FOOBAR_DB;
USE SCHEMA FOOBAR_DB.PUBLIC;

SHOW IMAGE REPOSITORIES IN SCHEMA;

DROP SERVICE IF EXISTS DBT_RUNNER;

-- Before running the following commands be sure to upload the image to the repository and upload the spcs file to the stage
CREATE SERVICE DBT_SERVICE
	IN COMPUTE POOL COMPUTE_POOL_FOOBAR
	FROM @SPECS
	SPEC = 'dbt-spec.yaml'
	MIN_INSTANCES = 1
	MAX_INSTANCES = 1;

SHOW SERVICES IN SCHEMA;

-- Getting Status and logs
SELECT SYSTEM$GET_SERVICE_STATUS('DBT_SERVICE');
SELECT SYSTEM$GET_SERVICE_LOGS('FOOBAR_DB.PUBLIC.DBT_SERVICE', 0, 'dbt-runner', 10);


-- Suspending service so it doesn't incur charges
USE ROLE ACCOUNTADMIN;
ALTER COMPUTE POOL IF EXISTS COMPUTE_POOL_FOOBAR SUSPEND;
